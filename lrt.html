<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <title>輕鐵到站時間 - LED風格</title>
    <style>
        body {
            background: #000;
            font-family: 'Courier New', monospace;
            color: #00ff00;
            margin: 0;
            padding: 20px;
            overflow: hidden;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #111;
            border: 2px solid #333;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
        }

        select {
            padding: 8px;
            background: #222;
            color: #00ff00;
            border: 1px solid #00ff00;
            border-radius: 3px;
            width: 100%;
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
        }

        .train-display {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .train-card {
            background: #111;
            border: 1px solid #00ff00;
            border-radius: 3px;
            padding: 10px;
            display: flex;
            align-items: center;
            height: 100px;
            overflow: hidden;
        }

        .route-info {
            display: flex;
            align-items: center;
            min-width: 150px;
            margin-right: 15px;
        }

        .route-no {
            font-size: 28px;
            font-weight: bold;
            background: #ff0000;
            color: #fff;
            padding: 5px;
            border-radius: 3px;
            min-width: 60px;
            text-align: center;
            margin-right: 10px;
        }

        .dest {
            font-size: 20px;
            color: #00ff00;
        }

        .details {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-right: 15px;
        }

        .time {
            font-size: 20px;
            color: #00ff00;
        }

        .train-length {
            display: flex;
            gap: 5px;
        }

        .train-image {
            width: 60px;
            height: auto;
            filter: brightness(1.5);
        }

        .error {
            color: #ff0000;
            text-align: center;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="container">
        <select id="stationSelect">
            <option value="">選擇車站</option>
        </select>
        <div id="trainDisplay" class="train-display"></div>
    </div>

    <script>
        // 更新後嘅車站列表
        const stations = {
            'n': '河田',
            '75': 'Choy Yee Bridge 蔡意橋',
            '80': 'Affluence 澤豐',
            '90': 'Tuen Mun Hospital 屯門醫院',
            '100': 'Siu Hong 兆康',
            '110': 'Kei Lun 麒麟',
            '120': 'Ching Chung 青松',
            '130': 'Kin Sang 建生',
            '140': 'Tin King 田景',
            '150': 'Leung King 良景',
            '160': 'San Wai 新圍',
            '170': 'Shek Pai 石排',
            '180': 'Shan King (North) 山景 (北)',
            '190': 'Shan King (South) 山景 (南)',
            '200': 'Ming Kum 鳴琴',
            '212': 'Tai Hing (North) 大興 (北)',
            '220': 'Tai Hing (South) 大興 (南)',
            '230': 'Ngan Wai 銀圍',
            '240': 'Siu Hei 兆禧',
            '250': 'Tuen Mun Swimming Pool 屯門泳池',
            '260': 'Town Centre 市中心', // 假設 260，原文無提供 ID
            '295': 'Tuen Mun 屯門',
            '300': 'Pui To 杯渡',
            '310': 'Hoh Fuk Tong 何福堂',
            '320': 'San Hui 新墟',
            '330': 'Prime View 景峰',
            '340': 'Fung Tei 鳳地',
            '350': 'Lam Tei 藍地',
            '360': 'Nai Wai 泥圍',
            '370': 'Chung Uk Tsuen 鍾屋村',
            '380': 'Hung Shui Kiu 洪水橋',
            '390': 'Tong Fong Tsuen 塘坊村',
            '400': 'Ping Shan 屏山',
            '425': 'Hang Mei Tsuen 坑尾村',
            '430': 'Tin Shui Wai 天水圍',
            '435': 'Tin Tsz 天慈',
            '445': 'Tin Yiu 天耀',
            '448': 'Locwood 樂湖',
            '450': 'Tin Wu 天湖',
            '455': 'Ginza 銀座',
            '460': 'Tin Shui 天瑞',
            '468': 'Chung Fu 頌富',
            '480': 'Tin Fu 天富',
            '490': 'Chestwood 翠湖',
            '500': 'Tin Wing 天榮',
            '510': 'Tin Yuet 天悅',
            '520': 'Tin Sau 天秀',
            '530': 'Wetland Park 濕地公園',
            '540': 'Tin Heng 天恒',
            '550': 'Tin Yat 天逸',
            '560': 'Shui Pin Wai 水邊圍',
            '570': 'Fung Nin Road 豐年路',
            '580': 'Hong Lok Road 康樂路',
            '590': 'Tai Tong Road 大棠路',
            '600': 'Yuen Long 元朗',
            '920': 'Sam Shing 三聖',
        };

        // 初始化車站選擇
        const stationSelect = document.getElementById('stationSelect');
        for (let [id, name] of Object.entries(stations)) {
            let option = document.createElement('option');
            option.value = id;
            option.textContent = name;
            stationSelect.appendChild(option);
        }

        // API 獲取數據
        async function getTrainSchedule(stationId) {
            const url = `https://rt.data.gov.hk/v1/transport/mtr/lrt/getSchedule?station_id=${stationId}`;
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP Error: ${response.status}`);
                }
                const data = await response.json();
                console.log(`API Response for station ${stationId}:`, data);
                return data;
            } catch (error) {
                console.error('Fetch Error:', error);
                return null;
            }
        }

        // 更新顯示
        async function updateDisplay() {
            const stationId = stationSelect.value;
            const trainDisplay = document.getElementById('trainDisplay');

            if (!stationId) {
                trainDisplay.innerHTML = '<p class="error">PLEASE SELECT STATION</p>';
                return;
            }

            trainDisplay.innerHTML = '<p>LOADING...</p>';
            const data = await getTrainSchedule(stationId);

            if (!data) {
                trainDisplay.innerHTML = '<p class="error">API CONNECTION FAILED</p>';
                return;
            }

            if (data.status !== 0) {
                console.warn('API Status is not 0:', data.status);
                trainDisplay.innerHTML = '<p class="error">WARNING: DATA MAY BE INCOMPLETE (STATUS: ' + data.status + ')</p>';
            } else {
                trainDisplay.innerHTML = '';
            }

            if (!data.platform_list || !Array.isArray(data.platform_list)) {
                trainDisplay.innerHTML += '<p class="error">NO PLATFORM DATA</p>';
                return;
            }

            const routes = data.platform_list
                .flatMap(p => p.route_list || [])
                .slice(0, 5); // 最多 5 個

            if (routes.length === 0) {
                trainDisplay.innerHTML += '<p class="error">NO ROUTE DATA AVAILABLE</p>';
                return;
            }

            routes.forEach((route, index) => {
                const trainCard = document.createElement('div');
                trainCard.className = 'train-card';

                // 路線資訊
                const routeInfo = document.createElement('div');
                routeInfo.className = 'route-info';

                const routeNo = document.createElement('div');
                routeNo.className = 'route-no';
                routeNo.textContent = route.route_no || 'N/A';

                const dest = document.createElement('div');
                dest.className = 'dest';
                dest.textContent = route.dest_ch || '未知';

                routeInfo.appendChild(routeNo);
                routeInfo.appendChild(dest);

                // 詳細資訊
                const details = document.createElement('div');
                details.className = 'details';

                const time = document.createElement('div');
                time.className = 'time';
                const minutes = route.time_en ? 
                    parseInt(route.time_en.replace(' min', '')) : 
                    null;
                time.textContent = minutes !== null ? (minutes === 0 ? '即將到達' : `${minutes} 分鐘`) : 'N/A';

                const trainLength = document.createElement('div');
                trainLength.className = 'train-length';
                const length = route.train_length ? parseInt(route.train_length) : 0;
                for (let i = 0; i < Math.min(length, 2); i++) { // 最多顯示 2 張
                    const trainImg = document.createElement('img');
                    trainImg.className = 'train-image';
                    trainImg.src = '12nanbu.png'; // 替換成實際路徑
                    trainLength.appendChild(trainImg);
                }

                details.appendChild(time);
                details.appendChild(trainLength);

                trainCard.appendChild(routeInfo);
                trainCard.appendChild(details);
                trainDisplay.appendChild(trainCard);
            });
        }

        // 監聽選擇改變
        stationSelect.addEventListener('change', updateDisplay);

        // 每分鐘更新
        setInterval(updateDisplay, 60000);
    </script>
</body>
</html>
